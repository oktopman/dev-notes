# Elastic Load Balancer

## ELB 란
ELB(Elastic Load Balancer)는 들어오는 어플리케이션 트래픽을 EC2 인스턴스, 컨테이너, IP주소, Lambda 함수와 같은 여러 대상에 자동으로 분산시킨다.  
단일 가용영역 또는 여러 가용 영역에서 다양한 어플리케이션 부하를 처리할 수 있다.  
세가지 로드밸런서를 제공하는데 고가용성, 자동 확장/축소, 강력한 보안을 갖추고 있다.  

## 왜 사용할까
AWS 클라우드상에 있는 것들은 탄력적이기 때문에 필연적으로 이러한 부분에 대응 할 수 있어야 한다.  
여러개의 EC2 인스턴스를 사용할때 유저가 어떤 인스턴스로 접근할지 IP 처리도 다 해줘야 하고 트래픽이 줄어듬에 따라 사용하는 인스턴스를 줄이게 된다면, 기존에 요청하는 IP 도 끊어줘야 하기때문에 관리부분에서 불편한 점이 많다.  
ELB 를 사용한다면 유저는 ELB로만 요청을 하면 된다.  
부하를 분산시켜주기도하고, 끊어진 인스턴스는 ELB가 알아서 요청을 보내지 않는다.  

## ELB 특징
### IP의 주소가 지속적으로 바뀜
분산 처리를 해야하기때문에 IP의 주소가 지속적으로 바뀐다. 그렇기 때문에 도메인기반으로 사용해야 한다. aws elb 를 생성하면 도메인이 하나 자동으로 부여된다.  

### Health Check
직접 트래픽을 발생시켜 인스턴스가 살아있는지를 체크한다. 인스턴스가 떠있는지 확인을 주기적으로 해서 끊어진 인스턴스로는 유저의 요청을 보내지 않는다.

### 3가지 종류
Application Load Balancer, Network Load Balancer, Clasic Load Balancer 가 존재한다.  
타겟그룹이란 EC2 인스턴스를 오토스케일링 할 수 있는 단위로 사용된다.  
`Clasic Load Balancer` 의 단점은 서버의 기본 주소가 바뀌면 로드밸런서를 새로 생성해야 하며, 하나의 주소에 하나의 타겟그룹으로만 보내게 된다.  
이러한 문제점은 서버의 구성이 비대해지고 마이크로 아키텍쳐를 구성하기 어렵다.  
예를 들어 회원, 정산 인스턴스가 따로 존재한다면 2개의 로드밸런서가 필요하게 된다.  

반면 `Application Load Balancer(ALB)` 는 path, 나 port 등에 따라 다른 타겟그룹으로 매핑할 수 있다.  
또한 타겟을 EC2 인스턴스, 람다, IP로도 연결이 가능하며 특정한 요청에 대해서는 서버없이 직접 응답메세지를 작성할 수 있기 때문에 마이크로 아키텍쳐 구성에 좋다.  
동일한 port 라도 path 등 에 따라 다르게 분기할 수도 있다.  
![image](https://user-images.githubusercontent.com/55048593/110647362-1ab86a80-81fb-11eb-8f53-1e9919668dc0.png)
출처 : https://medium.com/harrythegreat/aws-%EB%A1%9C%EB%93%9C%EB%B0%B8%EB%9F%B0%EC%8B%B1-%EC%95%8C%EC%95%84%EB%B3%B4%EA%B8%B0-9fd0955f859e

## Sticky Session
ELB 의 옵션으로 사용되며 로그인 세션을 유지하기 위해 사용한다.  
인스턴스가 이중화 되어있을때 로그인을 A 인스턴스를 통해 하였다면, ELB 는 그것을 쿠키에 저장해놓고 다음 요청을 받을때 마다 A 인스턴스로만 요청한다.  

## 참고
https://medium.com/harrythegreat/aws-%EB%A1%9C%EB%93%9C%EB%B0%B8%EB%9F%B0%EC%8B%B1-%EC%95%8C%EC%95%84%EB%B3%B4%EA%B8%B0-9fd0955f859e