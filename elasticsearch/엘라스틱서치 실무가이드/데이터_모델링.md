## 매핑 API 이해하기
### 매핑인덱스 만들기
- 매핑은 색인시 데이터가 어디에 어떻게 저장될지를 결정하는 설정. 인덱스에 추가되는 각 데이터 타입을 구체적으로 정의하는 일
- 엘라스틱서치는 기본적으로 스키마리스이기 때문에 매핑 설정없이 색인하면 원하지이않는 타입이 설정될수있음. 실수로 잘못된 타입이 지정될 경우 수정할 방법이 없다.
- 분석가능한 타입은 text, 해당 정보를 그대로 보여주기만 할 필드는 특성에따라 keyword, integer 타입 설정
- 필드는 계층구조를 가질수 있음
```
"mapping": {
    "_doc": {
        "directors": {
            "properties": {
                "peopleNm": {
                    "type": "keyword"
                }
            }
        }
    }
}
```
### 매핑 확인
- ES에서 제공하는 mapping API 로 생성한 매핑정보를 확인가능
```
GET movie_search/_mapping
```
### 매핑 파라미터
- 매핑 파라미터는 색인할 필드의 데이터를 어떻게 저장할지에 대한 다양한 옵션 제공
- analyzer, normalizer, boost, properties...  등등

### 메타 필드
- 메타 필드는 ES 에서 생성한 문서에서 제공하는 특별한 필드
- _index : 해당 문서(document)가 속한 인덱스의 이름을 담고있음
- _type, _uid, _all
- _id : 문서를 식별하는 유일한 키값
- _source : 문서의 원본 데이터를 제공. _reindex API 를 이용해 다른 인덱스에 재색인 가능
- _routing : 특정 문서를 특정 샤드에 저장하기 위해 사용자가 지정하는 메타 필드. 별도설정없이 색인시 문서는 수식에 따라 샤드에 골고루 분산 저장
```
Hash (document_id % num_of_shards)
```
특정 문서를 하나의 샤드에 저장하고 싶을때 _routing 메타 필드 사용. _routing 메타 필드 사용하면 색인시 해당 문서들을 동일한 라우팅 ID로 지정
```
// 색인
PUT test_index/_doc/1?routing=ko
{
    "name": "oktop"
}

// 조회
GET test_index/_search
{
  "query": {
    "terms": {
      "_routing": ["ko"] // 여러개 routing 값 조회 가ㅇ 
    }
  }
}
```

## 엘라스틱서치 분석기
### 텍스트 분석 개요
- ES 는 루씬 기반으로 구축된 텍스트 기반 검색 엔진
- ES 는 문서를 색인하기 전에 해당 문서의 필드 타입이 무엇인지 확인하고 텍스트타입이면 분석기를 이용해 분석

### 역색인 구조
### 분석기의 구조
### 분석기 사용법
- 분석기를 이용한 분석
- 필드를 이용한 분석
- 색인과 검색시 분석기를 각각 설정 가능
### 대표적인 분석기(Analyzer)
- Standard
- Whitespace
- Keyword

### 전처리 필터
### 토크나이저 필터
### 토큰 필터
### 동의어 사전

## 참고
http://www.yes24.com/Product/Goods/71893929